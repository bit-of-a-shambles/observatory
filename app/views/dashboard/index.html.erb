<div data-controller="dashboard" class="animate-fade-up">
  <%# Header %>
  <header class="py-8 border-b border-white/10">
    <div class="flex items-center gap-3 mb-1">
      <div class="w-2.5 h-2.5 rounded-full bg-[#ff4444] shadow-[0_0_12px_rgba(255,68,68,0.5)] animate-pulse-slow"></div>
      <span class="font-mono text-[11px] tracking-[3px] text-white/40 font-semibold uppercase">Live</span>
      <span class="font-mono text-[11px] text-white/20 ml-auto uppercase">Prot√≥tipo ‚Ä¢ Rails 8 + Hotwire</span>
    </div>
    <h1 class="font-['Space_Grotesk'] text-3xl font-bold tracking-tight bg-gradient-to-r from-[#e8e0d4] to-[#c8a84e] bg-clip-text text-transparent mb-1">
      Observat√≥rio de Integridade
    </h1>
    <p class="text-white/35 text-sm">
      Cruzamento automatizado de bases de dados p√∫blicas portuguesas para dete√ß√£o de irregularidades
    </p>
  </header>

  <%# Stats bar %>
  <div class="grid grid-cols-4 gap-[1px] my-6 bg-white/5 rounded-lg overflow-hidden">
    <% @stats.each do |stat| %>
      <div class="p-4 text-center bg-black/20">
        <div class="font-['Space_Grotesk'] text-2xl font-bold <%= stat[:color] %>">
          <%= stat[:value] %>
        </div>
        <div class="font-mono text-[10px] tracking-[2px] text-white/35 mt-0.5">
          <%= stat[:label] %>
        </div>
      </div>
    <% end %>
  </div>

  <%# Tabs %>
  <div class="flex border-b border-white/10 mb-6">
    <button data-dashboard-target="tab" data-tab="insights" data-action="click->dashboard#switchTab" 
            class="font-mono text-xs tracking-widest uppercase bg-none border-none px-5 py-3 cursor-pointer transition-all font-semibold text-[#c8a84e] border-b-2 border-[#c8a84e]">
      Insights <%= @insights.size %>
    </button>
    <button data-dashboard-target="tab" data-tab="cruzamentos" data-action="click->dashboard#switchTab" 
            class="font-mono text-xs tracking-widest uppercase bg-none border-none px-5 py-3 cursor-pointer transition-all font-semibold text-white/30 border-b-2 border-transparent">
      Cruzamentos
    </button>
    <button data-dashboard-target="tab" data-tab="fontes" data-action="click->dashboard#switchTab" 
            class="font-mono text-xs tracking-widest uppercase bg-none border-none px-5 py-3 cursor-pointer transition-all font-semibold text-white/30 border-b-2 border-transparent">
      Fontes
    </button>
  </div>

  <%# Insights Pane %>
  <div data-dashboard-target="pane" data-pane="insights" class="space-y-2">
    <%# Exposure banner %>
    <div class="bg-gradient-to-br from-[#c8a84e14] to-[#ff44440f] border border-[#c8a84e26] border-l-4 border-l-[#c8a84e] rounded-lg p-7 mb-6">
      <div class="font-mono text-[10px] tracking-[3px] text-[#c8a84e] mb-1">
        EXPOSI√á√ÉO TOTAL
      </div>
      <div class="flex justify-between items-baseline">
        <span class="font-['Space_Grotesk'] text-5xl font-bold text-[#e8e0d4] tracking-tighter">
          ‚Ç¨31.1M
        </span>
        <div class="text-right font-mono text-sm">
          <div class="text-white/50"><%= @insights.size %> irregularidades</div>
          <div class="text-white/35">12 fontes</div>
        </div>
      </div>
    </div>

    <%# Cards %>
    <div class="flex flex-col gap-2">
      <% @insights.each do |insight| %>
        <div data-action="click->dashboard#toggleInsight" 
             class="bg-white/[0.02] border border-white/[0.06] border-l-[3px] border-l-[#c8a84e] rounded-lg p-5 cursor-pointer transition-all hover:bg-white/[0.04]">
          <div class="flex justify-between items-start mb-2">
            <div class="flex items-center gap-3">
              <span class="bg-[#c8a84e22] text-[#c8a84e] font-mono text-[11px] font-bold px-2.5 py-0.5 rounded tracking-widest">
                <%= insight[:severity] %>
              </span>
              <span class="text-white/40 text-xs"><%= insight[:subtitle] %></span>
            </div>
            <div class="flex items-center gap-2">
               <div class="w-20 h-1 bg-white/[0.08] rounded overflow-hidden">
                 <div class="h-full bg-[#c8a84e]" style="width: <%= insight[:score] %>%"></div>
               </div>
               <span class="font-mono text-xs text-[#c8a84e] font-bold"><%= insight[:score] %>%</span>
            </div>
          </div>
          <h3 class="font-['Space_Grotesk'] text-lg font-semibold text-[#e8e0d4] my-2">
            <%= insight[:title] %>
          </h3>
          <div class="font-mono text-base text-[#c8a84e] font-medium">
            üí∞ <%= insight[:amount] %>
          </div>
          
          <div data-details class="hidden mt-4 animate-fade-up">
            <p class="text-white/65 text-sm leading-relaxed mb-4">
              <%= insight[:description] %>
            </p>
            <div class="bg-black/30 border-l-2 border-[#c8a84e55] rounded p-3 mb-3">
              <div class="font-mono text-[10px] text-white/35 tracking-widest mb-1.5 uppercase">Pattern</div>
              <div class="font-mono text-xs text-[#c8a84e] font-medium">
                <%= insight[:pattern] %>
              </div>
            </div>
            <div class="flex flex-wrap gap-1.5">
              <% insight[:sources].each do |source| %>
                <span class="font-mono text-[11px] text-white/45 bg-white/5 px-2.5 py-1 rounded border border-white/[0.08]">
                  <%= source %>
                </span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <%# Crossings Pane %>
  <div data-dashboard-target="pane" data-pane="cruzamentos" class="hidden">
    <h2 class="font-['Space_Grotesk'] text-xl font-semibold mb-2 text-[#e8e0d4]">Liga√ß√£o de entidades via NIF / NIPC</h2>
    <p class="text-white/40 text-sm mb-6">Identificador √∫nico como chave de cruzamento entre bases de dados</p>
    <div class="border border-white/[0.08] rounded-lg overflow-hidden">
      <div class="grid grid-cols-[1fr_120px] bg-white/[0.03] p-3 px-5 border-b border-white/[0.08] font-mono text-[11px] tracking-widest text-white/40">
        <span>CRUZAMENTO</span>
        <span class="text-right">CONTAGEM</span>
      </div>
      <% @crossings.each do |row| %>
        <div class="grid grid-cols-[1fr_120px] p-3.5 px-5 border-b border-white/[0.04] last:border-0 font-mono text-sm">
          <span class="text-white/60"><%= row[:label] %></span>
          <span class="text-[#c8a84e] font-bold text-right"><%= row[:count] %></span>
        </div>
      <% end %>
    </div>
  </div>

  <%# Sources Pane %>
  <div data-dashboard-target="pane" data-pane="fontes" class="hidden">
    <h2 class="font-['Space_Grotesk'] text-xl font-semibold mb-2">Fontes de Dados Conectadas</h2>
    <p class="text-white/40 text-sm mb-6">Bases de dados p√∫blicas portuguesas e europeias</p>
    <div class="grid grid-cols-2 gap-2">
      <% @sources.each do |source| %>
        <% dot_color = source[:status] == "active" ? "bg-[#44ff88] shadow-[0_0_6px_rgba(68,255,136,0.4)]" :
                       source[:status] == "error"  ? "bg-[#ff4444] shadow-[0_0_6px_rgba(255,68,68,0.4)]"  :
                                                     "bg-white/20" %>
        <div class="p-4 px-5 border border-white/[0.06] rounded-lg bg-white/[0.02]">
          <div class="flex justify-between items-center mb-1.5">
            <div>
              <span class="font-bold text-sm text-[#e8e0d4]"><%= source[:name] %></span>
              <span class="font-mono text-[10px] text-white/25 ml-2"><%= source[:country] %></span>
            </div>
            <div class="flex items-center gap-1.5">
              <div class="w-1.5 h-1.5 rounded-full <%= dot_color %>"></div>
              <span class="font-mono text-[10px] text-white/35 uppercase"><%= source[:status] %></span>
            </div>
          </div>
          <div class="flex justify-between font-mono">
            <span class="text-[11px] text-white/35"><%= source[:type] %></span>
            <span class="text-xs text-[#c8a84e]"><%= source[:records] %> registos</span>
          </div>
          <% if source[:synced_at] %>
            <div class="font-mono text-[10px] text-white/20 mt-1">sincronizado <%= source[:synced_at] %></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%# Footer %>
  <footer class="py-10 border-t border-white/[0.04] mt-12 text-center space-y-1">
    <div class="font-mono text-[10px] tracking-[2px] text-white/20">
      OBSERVAT√ìRIO DE INTEGRIDADE ‚Ä¢ PROT√ìTIPO ‚Ä¢ RAILS 8 + HOTWIRE
    </div>
    <div class="font-mono text-[10px] text-white/15">
      Fontes reais: Portal BASE ‚Ä¢ ECFP/CNE ‚Ä¢ Registo Comercial ‚Ä¢ RCBE ‚Ä¢ Tribunal de Contas ‚Ä¢ DGAL
    </div>
  </footer>
</div>
