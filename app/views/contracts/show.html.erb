<div class="animate-fade-up">
  <%# Header %>
  <header class="py-8 border-b border-white/10">
    <div class="flex items-center gap-4 mb-3">
      <%= link_to contracts_path, class: "font-mono text-[11px] tracking-[2px] text-white/30 hover:text-white/60 transition-colors" do %>
        ← Contracts
      <% end %>
      <% if @contract.country_code.present? %>
        <span class="font-mono text-[10px] text-white/20 bg-white/[0.04] px-2 py-0.5 rounded border border-white/[0.06]">
          <%= @contract.country_code %>
        </span>
      <% end %>
    </div>
    <h1 class="font-['Space_Grotesk'] text-2xl font-bold text-[#e8e0d4] leading-snug mb-2">
      <%= @contract.object %>
    </h1>
    <div class="font-mono text-[11px] text-white/25">
      ID <%= @contract.external_id %>
      <% if @contract.data_source %>
        · <%= @contract.data_source.name %>
      <% end %>
    </div>
  </header>

  <div class="grid grid-cols-[1fr_280px] gap-6 mt-6">

    <%# Main column %>
    <div class="space-y-5">

      <%# Price card %>
      <div class="bg-white/[0.02] border border-white/[0.06] rounded-lg p-5">
        <div class="font-mono text-[10px] tracking-[2px] text-white/35 mb-4 uppercase">Price</div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <div class="font-mono text-[10px] text-white/30 mb-1">Base Price</div>
            <div class="font-['Space_Grotesk'] text-2xl font-bold text-[#c8a84e]">
              <% if @contract.base_price %>
                €<%= number_with_delimiter(@contract.base_price.to_i) %>
                <span class="text-sm text-white/30 font-normal">.<%= "%02d" % (@contract.base_price.remainder(1).abs * 100).round %></span>
              <% else %>
                <span class="text-white/20 text-lg">—</span>
              <% end %>
            </div>
          </div>
          <div>
            <div class="font-mono text-[10px] text-white/30 mb-1">Effective Price</div>
            <div class="font-['Space_Grotesk'] text-2xl font-bold text-[#e8e0d4]">
              <% if @contract.total_effective_price %>
                €<%= number_with_delimiter(@contract.total_effective_price.to_i) %>
                <span class="text-sm text-white/30 font-normal">.<%= "%02d" % (@contract.total_effective_price.remainder(1).abs * 100).round %></span>
                <% if @contract.base_price && @contract.total_effective_price && @contract.base_price > 0 %>
                  <% delta_pct = ((@contract.total_effective_price - @contract.base_price) / @contract.base_price * 100).round(1) %>
                  <span class="text-xs font-mono ml-2 <%= delta_pct > 0 ? 'text-[#ff8844]' : 'text-[#44ff88]' %>">
                    <%= delta_pct > 0 ? "+" : "" %><%= delta_pct %>%
                  </span>
                <% end %>
              <% else %>
                <span class="text-white/20 text-lg">—</span>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <%# Details card %>
      <div class="bg-white/[0.02] border border-white/[0.06] rounded-lg p-5">
        <div class="font-mono text-[10px] tracking-[2px] text-white/35 mb-4 uppercase">Contract Details</div>
        <dl class="space-y-3">
          <% {
            "Contract Type"  => @contract.contract_type,
            "Procedure"      => @contract.procedure_type,
            "CPV Code"       => @contract.cpv_code,
            "Location"       => @contract.location,
          }.each do |label, value| %>
            <div class="grid grid-cols-[160px_1fr] gap-3 items-baseline">
              <dt class="font-mono text-[11px] text-white/30"><%= label %></dt>
              <dd class="text-sm text-[#e8e0d4]"><%= value.presence || "—" %></dd>
            </div>
          <% end %>
        </dl>
      </div>

      <%# Winners %>
      <% if @contract.winners.any? %>
        <div class="bg-white/[0.02] border border-white/[0.06] rounded-lg p-5">
          <div class="font-mono text-[10px] tracking-[2px] text-white/35 mb-4 uppercase">
            <%= @contract.winners.size == 1 ? "Winner" : "Winners" %>
          </div>
          <div class="space-y-2">
            <% @contract.winners.each do |winner| %>
              <div class="flex items-center justify-between py-2.5 px-3 bg-white/[0.02] border border-white/[0.05] rounded">
                <div>
                  <div class="text-sm text-[#e8e0d4] font-medium"><%= winner.name %></div>
                  <div class="font-mono text-[10px] text-white/30 mt-0.5">NIF <%= winner.tax_identifier %></div>
                </div>
                <% if winner.is_company? %>
                  <span class="font-mono text-[10px] text-white/30 bg-white/[0.04] px-2 py-0.5 rounded border border-white/[0.06]">Company</span>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

    </div>

    <%# Sidebar %>
    <div class="space-y-4">

      <%# Dates %>
      <div class="bg-white/[0.02] border border-white/[0.06] rounded-lg p-5">
        <div class="font-mono text-[10px] tracking-[2px] text-white/35 mb-4 uppercase">Dates</div>
        <dl class="space-y-3">
          <div>
            <dt class="font-mono text-[10px] text-white/30 mb-0.5">Publication</dt>
            <dd class="font-mono text-sm text-[#e8e0d4]">
              <%= @contract.publication_date&.strftime("%d %b %Y") || "—" %>
            </dd>
          </div>
          <div>
            <dt class="font-mono text-[10px] text-white/30 mb-0.5">Celebration</dt>
            <dd class="font-mono text-sm text-[#e8e0d4]">
              <%= @contract.celebration_date&.strftime("%d %b %Y") || "—" %>
            </dd>
          </div>
          <% if @contract.publication_date && @contract.celebration_date && @contract.celebration_date < @contract.publication_date %>
            <div class="font-mono text-[10px] text-[#ff4444] bg-[#ff44440d] border border-[#ff444422] rounded px-2 py-1.5">
              ⚠ Celebrated before publication
            </div>
          <% end %>
        </dl>
      </div>

      <%# Contracting entity %>
      <% if @contract.contracting_entity %>
        <div class="bg-white/[0.02] border border-white/[0.06] rounded-lg p-5">
          <div class="font-mono text-[10px] tracking-[2px] text-white/35 mb-4 uppercase">Contracting Entity</div>
          <div class="text-sm text-[#e8e0d4] font-medium leading-snug mb-1.5">
            <%= @contract.contracting_entity.name %>
          </div>
          <div class="font-mono text-[10px] text-white/30">
            NIF <%= @contract.contracting_entity.tax_identifier %>
          </div>
          <% if @contract.contracting_entity.is_public_body? %>
            <span class="inline-block mt-2 font-mono text-[10px] text-[#44ff88] bg-[#44ff880d] border border-[#44ff8822] px-2 py-0.5 rounded">
              Public body
            </span>
          <% end %>
        </div>
      <% end %>

      <%# Source %>
      <% if @contract.data_source %>
        <div class="bg-white/[0.02] border border-white/[0.06] rounded-lg p-5">
          <div class="font-mono text-[10px] tracking-[2px] text-white/35 mb-3 uppercase">Data Source</div>
          <div class="text-sm text-[#e8e0d4]"><%= @contract.data_source.name %></div>
          <div class="font-mono text-[10px] text-white/25 mt-1">
            <%= @contract.data_source.source_type.capitalize %>
            <% if @contract.data_source.last_synced_at %>
              · synced <%= @contract.data_source.last_synced_at.strftime("%Y-%m-%d") %>
            <% end %>
          </div>
        </div>
      <% end %>

    </div>
  </div>
</div>
